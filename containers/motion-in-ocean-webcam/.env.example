# Motion In Ocean - Webcam Mode Configuration
# Copy this file to .env and adjust as needed for your deployment
#
# üéõÔ∏è RUNTIME MANAGEMENT VIA UI
# Many of these settings can be modified at runtime through the web UI Settings panel
# without needing to restart containers. Look for [UI MANAGEABLE] comments below.
# Environment variables serve as system defaults; changes via the UI override them
# and are persisted to /data/application-settings.json
#
# Environment-only settings (e.g., MOTION_IN_OCEAN_PORT, MOCK_CAMERA) are not UI-editable;
# use these for system/deployment configuration that won't change frequently.

# Docker Image Tag (version to run)
# Default: latest
MOTION_IN_OCEAN_IMAGE_TAG=latest

# Web Server Port
# Default: 8000
MOTION_IN_OCEAN_PORT=8000

# Bind Host (address to listen on)
# Default: 127.0.0.1 (localhost only)
# Set to 0.0.0.0 to listen on all interfaces
MOTION_IN_OCEAN_BIND_HOST=0.0.0.0

# Timezone
# Default: Europe/London
TZ=Europe/London

# ========== CAMERA SETTINGS ==========
# These settings can be managed at runtime via the web UI Settings panel (no restart needed)
# Environment variable values serve as system defaults; UI changes override them

# Camera Resolution
# Default: 1280x720
# [UI MANAGEABLE] Runtime-editable via Settings tab
MOTION_IN_OCEAN_RESOLUTION=1280x720

# Camera FPS (Frames Per Second)
# Default: 30
# [UI MANAGEABLE] Runtime-editable via Settings tab
MOTION_IN_OCEAN_FPS=30

# Target FPS (may differ from actual if hardware-limited)
# Default: (empty)
MOTION_IN_OCEAN_TARGET_FPS=

# JPEG Quality (1-100)
# Default: 85
# [UI MANAGEABLE] Runtime-editable via Settings tab
MOTION_IN_OCEAN_JPEG_QUALITY=85

# Maximum concurrent stream connections
# Default: 2
# [UI MANAGEABLE] Runtime-editable via Settings tab
MOTION_IN_OCEAN_MAX_STREAM_CONNECTIONS=2

# Raspberry Pi 3 Performance Profile
# Set to 'true' if running on Pi 3 for optimizations
# Default: false
MOTION_IN_OCEAN_PI3_PROFILE=false

# OctoPrint Compatibility Mode
# Set to 'true' if integrating with OctoPrint
# Default: false
MOTION_IN_OCEAN_OCTOPRINT_COMPATIBILITY=false

# CORS Origins (comma-separated list)
# Default: *
MOTION_IN_OCEAN_CORS_ORIGINS=*

# Mock Camera Mode (for testing without hardware)
# Set to 'true' to use synthetic camera instead of real hardware
# Default: false
MOCK_CAMERA=false

# ========== CAT GIF MODE (MOCK CAMERA ENHANCEMENT) ==========
# Display animated cat GIFs from cataas.com instead of black frames
# Only active when MOCK_CAMERA=true AND CAT_GIF=true
# Useful for visual testing and entertainment!

# Enable Cat GIF Mode
# When enabled with MOCK_CAMERA=true, streams animated cats instead of black frames
# Each refresh fetches a new cat GIF from the cataas.com API
# Default: false
CAT_GIF=false

# Cat GIF API URL
# The endpoint to fetch cat GIFs from
# The cataas.com API is free and open-source: https://cataas.com/doc.html
# Default: https://cataas.com/cat.gif
CATAAS_API_URL=https://cataas.com/cat.gif

# Cat GIF Cache TTL (seconds)
# How long to keep a GIF sequence in memory before fetching a new cat
# Lower values = fresher cats, but more API requests
# Higher values = fewer requests, but less variety in cats
# Default: 60 seconds
CAT_GIF_CACHE_TTL_SECONDS=60

# Optional: Bearer token for management node integration
# Required only if this webcam node is registered with a management node
# that has MANAGEMENT_AUTH_TOKEN configured.
# Leave empty if this node runs standalone
# Must match the management node's MANAGEMENT_AUTH_TOKEN
# See: Node Registry Management in README
MANAGEMENT_AUTH_TOKEN=

# ========== NODE DISCOVERY & SELF-REGISTRATION ==========
# These settings can be managed at runtime via the web UI Settings panel (no restart needed)
# Enable this webcam to announce itself to a management node automatically
# Useful for multi-device setups. Use only on trusted networks.

# Enable Discovery Self-Registration
# Set to 'true' to announce this webcam to a management node automatically
# Default: false
# [UI MANAGEABLE] Runtime-editable via Settings tab
DISCOVERY_ENABLED=false

# Management Node Base URL
# Where this webcam sends discovery announcements
# Example: http://192.168.1.10:8001
# [UI MANAGEABLE] Runtime-editable via Settings tab
DISCOVERY_MANAGEMENT_URL=http://127.0.0.1:8001

# Discovery Shared Token
# Must match NODE_DISCOVERY_SHARED_SECRET on the management node
# Generate a strong random string and use same value on both nodes
# [UI MANAGEABLE] Runtime-editable via Settings tab
DISCOVERY_TOKEN=

# Discovery Announcement Interval (seconds)
# How often to (re)announce to the management node
# Default: 30 seconds
# [UI MANAGEABLE] Runtime-editable via Settings tab
DISCOVERY_INTERVAL_SECONDS=30

# Optional Explicit Node ID
# Auto-generated as stable hash if not set
# Only set if you need a predictable node identifier
DISCOVERY_NODE_ID=

# ========== NODE ADVERTISEMENT & CONNECTIVITY ==========
# Controls how this webcam advertises its network location

# Base URL for Discovery Announcements (optional)
# URL that management node will use to reach this webcam
# Set when:
#  - Running on multiple hosts (container ID won't resolve across network)
#  - Using DISCOVERY_ENABLED=true with a remote management node
#  - Using custom hostnames or DNS names
# Examples:
#  - http://192.168.88.105:8000 (IP address)
#  - http://prusa-cam.local:8000 (mDNS/DNS hostname)
#  - http://webcam-prod.example.com:8000 (FQDN)
# Default behavior: auto-detects using socket.gethostname() + port 8000
# Note: Container ID (e.g., 8e13a643c056:8000) won't resolve from remote hosts
BASE_URL=

# ========== LOGGING CONFIGURATION ==========
# These settings can be managed at runtime via the web UI Settings panel (no restart needed)
# Control logging output verbosity and format

# Log Level
# One of: DEBUG (most verbose) | INFO | WARNING | ERROR | CRITICAL (least verbose)
# DEBUG: All internal details, useful for troubleshooting
# INFO: Standard operational messages (recommended for production)
# WARNING: Only problems that don't affect operation
# ERROR: Only serious failures
# Default: INFO
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_LEVEL=INFO

# Log Format
# text: Human-readable format suitable for console output
# json: Structured JSON for log aggregation systems (ELK, Splunk, etc.)
# Default: text
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_FORMAT=text

# Include Process/Thread Identifiers in Logs
# Set to 'true' to include Python process ID and thread ID in log output
# Useful for debugging concurrency issues with multiple threads
# Default: false
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_INCLUDE_IDENTIFIERS=false

# ========== PERFORMANCE & TESTING ==========
# Tune streaming performance and enable test modes

# Maximum Frame Cache Age (seconds)
# How long to keep encoded JPEG frames in memory before re-encoding
# Lower values = fresher frames, higher CPU/memory usage
# Higher values = stale frames possible, lower CPU/memory usage
# Set to 0 to bypass caching entirely (not recommended)
# Default: 10.0
# [UI MANAGEABLE] Runtime-editable via Settings tab
MAX_FRAME_AGE_SECONDS=10.0

# Enable API Test Mode
# Generates synthetic test frames and responses without hardware
# Useful for testing endpoints without a physical camera
# DO NOT enable in production
# Default: false
API_TEST_MODE_ENABLED=false

# API Test Cycle Interval (seconds)
# How often test patterns advance when API_TEST_MODE_ENABLED=true
# Lower values = API gets exercised more frequently
# Only applies if API_TEST_MODE_ENABLED=true
# Default: 5.0
API_TEST_CYCLE_INTERVAL_SECONDS=5.0

# Rate Limiter Storage Backend
# Where to store rate limiting state for concurrent stream limits
# memory:// = in-process memory (good for single instance)
# Default: memory://
LIMITER_STORAGE_URI=memory://

# ========== APPLICATION CONFIGURATION ==========
# Advanced features and internal configuration

# Allow PyKMS Mock Implementation
# For internal use: allow mock KMS when unavailable
# Default: false
ALLOW_PYKMS_MOCK=false

# Node Registry Path
# Path to JSON file storing registered node metadata
# Used by management node to persist node state
# This is typically `/data/node-registry.json` in Docker containers
# Default: /data/node-registry.json
NODE_REGISTRY_PATH=/data/node-registry.json

# Application Settings Path
# Path to persisted runtime UI settings JSON file
# Use a writable alternate path (for restricted deployments) if /data is read-only
# Default: /data/application-settings.json
APPLICATION_SETTINGS_PATH=/data/application-settings.json


# ========== FEATURE FLAGS ==========
# Experimental and optional features. Most disabled by default for stability.
# Reference pi_camera_in_docker/feature_flags.py for implementation details.
# 
# NOTE: All feature flags below are [UI MANAGEABLE] Runtime-editable via Settings tab
# Changes take effect immediately or notify about restart requirements
#
# ---- PERFORMANCE OPTIMIZATION ----

# Automatic JPEG Quality Adaptation
# Dynamically adjust JPEG compression quality based on network bandwidth
# Reduces quality when clients are slow to prevent buffer buildup
# Trade-off: slightly lower image quality for better responsiveness
# Default: false
MOTION_IN_OCEAN_QUALITY_ADAPTATION=false

# Adaptive FPS Throttling
# Automatically reduce frame rate when CPU load exceeds threshold
# Prevents capture/encoding pipeline from overloading the system
# Trade-off: lower frame rate during peak CPU load
# Default: false
MOTION_IN_OCEAN_FPS_THROTTLE_ADAPTIVE=false

# Frame Size Optimization
# Automatically downscale frames if client has lower resolution capability
# Reduces bandwidth and processing for mobile/low-res clients
# Detection based on HTTP Accept headers and historical client behavior
# Default: true
MOTION_IN_OCEAN_FRAME_SIZE_OPTIMIZATION=true

# ---- HARDWARE-SPECIFIC OPTIMIZATIONS ----

# Raspberry Pi 3 Optimizations
# Enable memory and CPU-friendly encoding for Pi 3 hardware
# Reduces resource consumption on resource-constrained hardware
# Equivalent to MOTION_IN_OCEAN_PI3_PROFILE (legacy name)
# Default: false
MOTION_IN_OCEAN_PI3_OPTIMIZATION=false

# Raspberry Pi 5 Optimizations
# Enable Pi 5-specific accelerations: H.264/H.265 hardware encoding
# Takes advantage of Pi 5's improved capabilities
# Default: false
MOTION_IN_OCEAN_PI5_OPTIMIZATION=false

# Multi-Camera Support
# Enable support for multiple camera inputs on single host
# Experimental feature; requires additional camera configuration
# Each camera gets its own endpoint (/api/camera/1, /api/camera/2, etc.)
# Default: false
MOTION_IN_OCEAN_MULTI_CAMERA_SUPPORT=false

# ---- DEBUGGING & DEVELOPMENT ----

# Enhanced Debug Logging
# Enable DEBUG-level structured logging for development/troubleshooting
# More verbose than LOG_LEVEL=DEBUG; includes low-level function traces
# Very noisy; significantly impacts performance
# Default: false
MOTION_IN_OCEAN_DEBUG_LOGGING=false

# Trace-Level Logging
# Log at TRACE level: extremely detailed internal state debugging
# Most verbose possible output; severely impacts performance
# Only for local development when diagnosing specific issues
# Default: false
MOTION_IN_OCEAN_TRACE_LOGGING=false

# Performance Profiling
# Periodically log CPU, memory, and per-module resource consumption
# Helps identify bottlenecks and performance regressions
# Logs profiling data every 60 seconds
# Default: false
MOTION_IN_OCEAN_PERFORMANCE_PROFILING=false

# Development Mode
# Relaxes input validation and enables internal debugging endpoints
# Examples: Accept malformed requests, expose internal config endpoints
# SECURITY: Never enable in production environments
# Default: false
MOTION_IN_OCEAN_DEVELOPMENT_MODE=false

# ---- EXPERIMENTAL STREAMING FEATURES ----

# Motion Detection Hooks
# Enable motion detection preprocessing and optional HTTP webhooks
# Requires integration with external motion detection service
# Fires webhook when motion detected; useful for alerts or automation
# Default: false
MOTION_IN_OCEAN_MOTION_DETECTION=false

# Frame Recording to Disk
# Record streaming frames to local disk for playback/analysis
# High overhead: generates large videos quickly
# Useful for security/audit purposes but impacts storage and I/O
# Default: false
MOTION_IN_OCEAN_FRAME_RECORDING=false

# ---- INTEGRATION & COMPATIBILITY ----

# Core CORS Support
# Enable Cross-Origin Resource Sharing for browser-based clients
# Allows webcam API access from different domains
# Configure allowed origins with MOTION_IN_OCEAN_CORS_ORIGINS
# Default: true
MOTION_IN_OCEAN_CORS_SUPPORT=true

# Home Assistant Integration
# Apply Home Assistant-specific response optimizations
# Examples: Reduced payload sizes, improved timeout handling
# If integrating with Home Assistant, enable for better reliability
# Default: false
MOTION_IN_OCEAN_HOME_ASSISTANT_INTEGRATION=false

# ---- OBSERVABILITY ----

# Prometheus Metrics Export
# Expose /metrics endpoint with Prometheus-format metrics
# Includes frame counts, endpoint latencies, error rates, active connections
# Scrape with Prometheus: curl http://webcam:8000/metrics
# Default: false
MOTION_IN_OCEAN_PROMETHEUS_METRICS=false

# Enhanced Frame Statistics
# Collect detailed per-frame statistics (encode time, size, quality score)
# Periodically logs aggregated statistics to help identify performance issues
# Minimal overhead: only when frames are actually encoded
# Default: false
MOTION_IN_OCEAN_ENHANCED_FRAME_STATS=false

# Request Tracing
# Log complete request lifecycle: arrival ‚Üí routing ‚Üí processing ‚Üí response
# Extremely verbose; one log entry per HTTP request with timing
# Use only for troubleshooting API issues; impacts readability
# Default: false
MOTION_IN_OCEAN_REQUEST_TRACING=false

# ---- EXPERIMENTAL FEATURES / GRADUAL ROLLOUTS ----

# New Streaming API (v2)
# Enable experimental v2 streaming endpoint alongside existing v1
# v2 features: improved backpressure handling, chunked encoding, better error handling
# v1 endpoints unchanged; v2 available at /api/v2/stream
# For testing v2 without losing v1 compatibility
# Default: false
MOTION_IN_OCEAN_NEW_STREAMING_API=false

# Alternative Protocols Support
# Enable RTSP, HLS, and WebRTC streaming in addition to MJPEG
# Each protocol adds memory and CPU overhead
# Only enable if you need specific protocol support
# Default: false
MOTION_IN_OCEAN_ALTERNATIVE_PROTOCOLS=false

# ---- ERROR TRACKING & MONITORING ----

# Sentry DSN for Error Tracking
# Optional Sentry integration for error tracking and monitoring
# When set, enables automatic error reporting to your Sentry project
# Leave empty to disable Sentry (default, suitable for development)
# Get your DSN from https://sentry.io after creating a project
# Format: https://your-project-key@o0.ingest.sentry.io/your-project-id
#
# Features when enabled:
# - Automatic exception capture
# - Camera hardware failures tracked
# - Network/discovery errors monitored
# - Stream disconnects and timeouts logged
# - Data redaction: auth tokens automatically removed before sending
#
# Performance Impact:
# - Minimal overhead (<1ms per request)
# - Async transport (non-blocking)
# - ~10% transaction sampling (configurable)
# - Good for Raspberry Pi deployments
#
# Example:
#   SENTRY_DSN=https://abc123@o4510014518919168.ingest.sentry.io/4510897945116752
#
# Default: (empty - Sentry disabled)
SENTRY_DSN=
