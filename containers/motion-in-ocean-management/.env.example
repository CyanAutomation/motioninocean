# Motion In Ocean - Management Mode Configuration
# Copy this file to .env and adjust as needed for your deployment
#
# üéõÔ∏è RUNTIME MANAGEMENT VIA UI
# Many of these settings can be modified at runtime through the web UI Settings panel
# without needing to restart containers. Look for [UI MANAGEABLE] comments below.
# Environment variables serve as system defaults; changes via the UI override them
# and are persisted to /data/application-settings.json
#
# Environment-only settings (e.g., MOTION_IN_OCEAN_PORT, MOCK_CAMERA, NODE_DISCOVERY_SHARED_SECRET)
# are not UI-editable; use these for system/deployment configuration that won't change frequently.

# Docker Image Tag (version to run)
# Default: latest
MOTION_IN_OCEAN_IMAGE_TAG=latest

# Web Server Port
# Default: 8001 (to avoid conflict with webcam mode on 8000)
MOTION_IN_OCEAN_PORT=8001

# Bind Host (address to listen on)
# Default: 127.0.0.1 (localhost only)
# Set to 0.0.0.0 to listen on all interfaces (required for remote node discovery)
MOTION_IN_OCEAN_BIND_HOST=0.0.0.0

# Timezone
# Default: Europe/London
TZ=Europe/London

# Application Mode
# Management mode: runs the web UI and node registry for managing webcam nodes
# Default: management
APP_MODE=management

# Mock Camera Mode (for testing)
# Set to 'true' to use synthetic camera
# Default: false
MOCK_CAMERA=false

# Optional: Bearer token for authentication
# Leave empty to disable authentication (default, suitable for localhost)
# Set to any string to require bearer token auth on protected endpoints
MANAGEMENT_AUTH_TOKEN=

# Node Discovery Shared Secret
# Required for webcam nodes that self-register via /api/discovery/announce.
# Must match DISCOVERY_TOKEN on webcam nodes.
# Leave empty to disable discovery announcements.
NODE_DISCOVERY_SHARED_SECRET=

# SSRF Protection: Allow Private IPs
# SECURITY WARNING: Only enable for internal networks you trust!
# When disabled (default), blocks connections to private IP ranges (10.x.x.x, 192.168.x.x, 172.16.x.x)
# to prevent server-side request forgery attacks.
# Discovery announcements using private/LAN IPs are blocked unless this is true.
# Enable only if:
#  1. Your management node can only reach internal/trusted networks
#  2. You need to connect to webcam nodes using private IPs directly
#  3. You understand the security implications
# Recommended: Always use docker network hostnames instead (e.g., 'webcam-container:8000')
# See: Node Connectivity Troubleshooting in README
# Default: false
MOTION_IN_OCEAN_ALLOW_PRIVATE_IPS=false

# Docker Socket Proxy Configuration (for docker transport)
# Only needed if using 'docker' transport for remote node connections
# Default proxy port if using docker-socket-proxy service
DOCKER_PROXY_PORT=2375

# ========== LOGGING CONFIGURATION ==========
# These settings can be managed at runtime via the web UI Settings panel (no restart needed)
# Control logging output verbosity and format

# Log Level
# One of: DEBUG (most verbose) | INFO | WARNING | ERROR | CRITICAL (least verbose)
# DEBUG: All internal details, useful for troubleshooting
# INFO: Standard operational messages (recommended for production)
# WARNING: Only problems that don't affect operation
# ERROR: Only serious failures
# Default: INFO
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_LEVEL=INFO

# Log Format
# text: Human-readable format suitable for console output
# json: Structured JSON for log aggregation systems (ELK, Splunk, etc.)
# Default: text
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_FORMAT=text

# Include Process/Thread Identifiers in Logs
# Set to 'true' to include Python process ID and thread ID in log output
# Useful for debugging concurrency issues with multiple threads
# Default: false
# [UI MANAGEABLE] Runtime-editable via Settings tab
LOG_INCLUDE_IDENTIFIERS=false

# ========== PERFORMANCE & TESTING ==========
# Configuration for performance tuning and test modes

# Maximum Frame Cache Age (seconds)
# How long to keep encoded JPEG frames in memory before re-encoding
# Lower values = fresher frames, higher CPU/memory usage
# Higher values = stale frames possible, lower CPU/memory usage
# Set to 0 to bypass caching entirely (not recommended)
# Default: 10.0
# Note: Management mode doesn't process video directly, but setting configures system behavior
MAX_FRAME_AGE_SECONDS=10.0

# Enable API Test Mode
# Generates synthetic test frames and responses without hardware
# Useful for testing node registry and management endpoints without real webcam nodes
# DO NOT enable in production
# Default: false
API_TEST_MODE_ENABLED=false

# API Test Cycle Interval (seconds)
# How often test patterns advance when API_TEST_MODE_ENABLED=true
# Shorter intervals exercise the API more frequently
# Only applies if API_TEST_MODE_ENABLED=true
# Default: 5.0
API_TEST_CYCLE_INTERVAL_SECONDS=5.0

# Rate Limiter Storage Backend
# Where to store rate limiting state for API endpoints
# memory:// = in-process memory (good for single instance)
# Default: memory://
LIMITER_STORAGE_URI=memory://

# ========== APPLICATION CONFIGURATION ==========
# Advanced features and internal configuration

# Allow PyKMS Mock Implementation
# For internal use: allow mock KMS when unavailable
# Default: false
ALLOW_PYKMS_MOCK=false

# Node Registry Path
# Path to persistent JSON file storing registered node metadata
# Used by management node to track and manage webcam nodes
# This is typically `/data/node-registry.json` in Docker containers
# Default: /data/node-registry.json
NODE_REGISTRY_PATH=/data/node-registry.json

# ========== FEATURE FLAGS ==========
# Experimental and optional features. Most disabled by default for stability.
# Reference pi_camera_in_docker/feature_flags.py for implementation details.
# 
# NOTE: All feature flags below are [UI MANAGEABLE] Runtime-editable via Settings tab
# Changes take effect immediately or notify about restart requirements
#
# ---- DEBUGGING & DEVELOPMENT ----

# Enhanced Debug Logging
# Enable DEBUG-level structured logging for development/troubleshooting
# More verbose than LOG_LEVEL=DEBUG; includes low-level function call traces
# Useful for debugging node discovery and management API issues
# Default: false
MOTION_IN_OCEAN_DEBUG_LOGGING=false

# Trace-Level Logging
# Log at TRACE level: extremely detailed internal state debugging
# Most verbose possible output; severely impacts performance
# Only for local development when diagnosing specific node registry issues
# Default: false
MOTION_IN_OCEAN_TRACE_LOGGING=false

# Performance Profiling
# Periodically log CPU and memory usage per module
# Helps identify bottlenecks in node discovery and API serving
# Logs profiling data every 60 seconds
# Default: false
MOTION_IN_OCEAN_PERFORMANCE_PROFILING=false

# Development Mode
# Relaxes input validation and enables additional debugging endpoints
# Examples: Accept malformed discovery payloads, expose internal registry dumps
# SECURITY: Never enable in production environments
# Default: false
MOTION_IN_OCEAN_DEVELOPMENT_MODE=false

# ---- OBSERVABILITY ----

# Prometheus Metrics Export
# Expose /metrics endpoint with Prometheus-format metrics
# Includes node discovery events, API latencies, registry operations
# Scrape with Prometheus: curl http://management:8001/metrics
# Default: false
MOTION_IN_OCEAN_PROMETHEUS_METRICS=false

# Enhanced Frame Statistics
# Collect detailed statistics on management operations (node registrations, connectivity checks)
# Periodically logs aggregated statistics to help identify operational patterns
# Minimal overhead: only when operations occur
# Default: false
MOTION_IN_OCEAN_ENHANCED_FRAME_STATS=false

# Request Tracing
# Log complete request lifecycle: arrival ‚Üí routing ‚Üí processing ‚Üí response
# Extremely verbose; one log entry per HTTP request with timing
# Use only for troubleshooting node discovery and API issues
# Default: false
MOTION_IN_OCEAN_REQUEST_TRACING=false

# ---- INTEGRATION & COMPATIBILITY ----

# Core CORS Support
# Enable Cross-Origin Resource Sharing for browser-based clients
# Allows management UI to be accessed from different domains
# Default: true
MOTION_IN_OCEAN_CORS_SUPPORT=true

# Home Assistant Integration
# Apply Home Assistant-specific optimizations for node discovery
# Improves compatibility if Home Assistant instances discover nodes
# Default: false
MOTION_IN_OCEAN_HOME_ASSISTANT_INTEGRATION=false

# ---- EXPERIMENTAL FEATURES ----

# Alternative Protocols Support
# Enable RTSP, HLS, and WebRTC protocol support for managed nodes
# Each protocol adds memory and CPU overhead to proxy requests
# Only enable if you need specific protocol support across the network
# Default: false
MOTION_IN_OCEAN_ALTERNATIVE_PROTOCOLS=false

# ---- ERROR TRACKING & MONITORING ----

# Sentry DSN for Error Tracking
# Optional Sentry integration for error tracking and monitoring
# When set, enables automatic error reporting to your Sentry project
# Leave empty to disable Sentry (default, suitable for development)
# Get your DSN from https://sentry.io after creating a project
# Format: https://your-project-key@o0.ingest.sentry.io/your-project-id
#
# Features when enabled:
# - Automatic exception capture
# - Node connectivity failures tracked
# - Management API errors monitored
# - Node registry corruption detected
# - HTTP 5xx responses logged
# - Data redaction: auth tokens automatically removed before sending
#
# Performance Impact:
# - Minimal overhead (<1ms per request)
# - Async transport (non-blocking)
# - ~10% transaction sampling (configurable)
# - Good for distributed deployments
#
# Example:
#   SENTRY_DSN=https://abc123@o4510014518919168.ingest.sentry.io/4510897945116752
#
# Default: (empty - Sentry disabled)
SENTRY_DSN=
