<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="motion-in-ocean - Raspberry Pi Camera Live Stream" />
    <title>motion-in-ocean - Camera Stream</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabs-config.css') }}" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-title">
          <div class="logo-icon">üìπ</div>
          <h1>motion-in-ocean</h1>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
          <button class="tab-btn active" data-tab="main" id="main-tab-btn" title="Stream">
            <span class="tab-icon">üìπ</span>
            <span class="tab-label">Stream</span>
          </button>
          <button class="tab-btn" data-tab="config" id="config-tab-btn" title="Configuration">
            <span class="tab-icon">‚öôÔ∏è</span>
            <span class="tab-label">Configuration</span>
          </button>
          <button class="tab-btn" data-tab="setup" id="setup-tab-btn" title="Set-Up">
            <span class="tab-icon">üîß</span>
            <span class="tab-label">Set-Up</span>
          </button>
        </div>

        <div class="connection-status" aria-live="polite" role="status">
          <div id="status-indicator" class="status-indicator connecting"></div>
          <span id="status-text" class="status-text">Connecting...</span>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <main class="container">
      <!-- Video Section -->
      <section class="video-section">
        <div class="video-container ui-card video-container-block">
          <div class="video-wrapper">
            <!-- Loading Overlay -->
            <div class="loading-overlay">
              <div class="loading-spinner"></div>
              <div class="loading-text">Loading camera stream...</div>
            </div>

            <!-- Video Stream -->
            <img
              id="video-stream"
              class="video-stream"
              src="{{ url_for('video_feed') }}"
              alt="Camera Live Stream"
              width="{{ width }}"
              height="{{ height }}"
            />
          </div>

          <!-- Video Controls -->
          <div class="video-controls">
            <button
              id="refresh-btn"
              class="control-btn ui-btn ui-btn--overlay"
              title="Refresh Stream"
            >
              <span class="control-btn-icon">‚Üª</span>
              <span class="control-btn-text">Refresh</span>
            </button>
            <button
              id="fullscreen-btn"
              class="control-btn ui-btn ui-btn--overlay"
              title="Toggle Fullscreen"
            >
              <span class="control-btn-icon">‚õ∂</span>
              <span class="control-btn-text">Fullscreen</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Stats Panel -->
      <aside id="stats-panel" class="stats-panel ui-card stats-panel-card">
        <div class="stats-header ui-panel-header">
          <h2>Stream Statistics</h2>
          <button id="toggle-stats-btn" class="toggle-stats-btn" title="Toggle Stats">‚ñ≤</button>
        </div>

        <div class="stats-content">
          <!-- Performance Stats -->
          <div class="stat-group ui-list-block stats-panel-card">
            <div class="stat-group-title">Performance</div>
            <div class="stat-item">
              <span class="stat-label">Current FPS</span>
              <span id="fps-value" class="stat-value highlight">--</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Frames Captured</span>
              <span id="frames-value" class="stat-value">--</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Uptime</span>
              <span id="uptime-value" class="stat-value">--</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Last Frame Age</span>
              <span id="last-frame-age-value" class="stat-value">--</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Max Frame Age</span>
              <span id="max-frame-age-value" class="stat-value">--</span>
            </div>
          </div>

          <!-- Stream Configuration -->
          <div class="stat-group ui-list-block stats-panel-card">
            <div class="stat-group-title">Configuration</div>
            <div class="stat-item">
              <span class="stat-label">Resolution</span>
              <span id="resolution-value" class="stat-value">{{ width }} √ó {{ height }}</span>
            </div>
          </div>

          <!-- Last Updated -->
          <div id="last-updated" class="last-updated">Fetching stats...</div>
        </div>
      </aside>

      <!-- Configuration Panel -->
      <div id="config-panel" class="config-panel hidden">
        <!-- Loading Overlay -->
        <div id="config-loading" class="config-loading hidden">
          <div class="config-spinner"></div>
          <div class="config-loading-text">Loading configuration...</div>
        </div>

        <div class="config-content">
          <!-- Camera Settings Group (Editable) -->
          <div class="config-group editable-section ui-card config-group-block">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">üì∑ Camera Settings</h3>
              <button class="config-group-toggle" data-group="camera" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="camera">
              <div class="config-item ui-form-control">
                <span class="config-label">Resolution</span>
                <span id="config-resolution" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Frame Rate (FPS)</span>
                <span id="config-fps" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Target FPS (Throttle)</span>
                <span id="config-target-fps" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">JPEG Quality</span>
                <span id="config-jpeg-quality" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
            </div>
          </div>

          <!-- Stream Control Group (Read-only) -->
          <div class="config-group readonly-section ui-card config-group-block">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">üì° Stream Control</h3>
              <button class="config-group-toggle" data-group="stream" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="stream">
              <div class="config-item ui-form-control">
                <span class="config-label">Max Connections</span>
                <span id="config-max-connections" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Current Connections</span>
                <span
                  id="config-current-connections"
                  class="config-value highlight"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Max Frame Age (Timeout)</span>
                <span id="config-max-frame-age" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">CORS Origins</span>
                <span id="config-cors" class="config-value" data-config-value="true">--</span>
              </div>
            </div>
          </div>

          <!-- Runtime Info Group (Read-only) -->
          <div class="config-group readonly-section ui-card config-group-block">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">‚öôÔ∏è Runtime Information</h3>
              <button class="config-group-toggle" data-group="runtime" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="runtime">
              <div class="config-item ui-form-control">
                <span class="config-label">Camera Active</span>
                <span id="config-camera-active" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Mock Camera</span>
                <span id="config-mock-camera" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Uptime</span>
                <span id="config-uptime" class="config-value highlight" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Last Updated</span>
                <span id="config-timestamp" class="config-value" data-config-value="true">--</span>
              </div>
            </div>
          </div>

          <!-- Limits Info Group (Read-only) -->
          <div class="config-group readonly-section ui-card config-group-block">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">üìä System Limits</h3>
              <button class="config-group-toggle" data-group="limits" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="limits">
              <div class="config-item ui-form-control">
                <span class="config-label">Max Resolution</span>
                <span id="config-limit-resolution" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Max FPS</span>
                <span id="config-limit-fps" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">JPEG Quality Range</span>
                <span id="config-limit-jpeg" class="config-value" data-config-value="true">--</span>
              </div>
            </div>
          </div>

          <!-- Error Alert -->
          <div id="config-error-alert" class="config-alert error hidden">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="config-error-message" class="alert-message"
              >Failed to load configuration</span
            >
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>

          <!-- Footer -->
          <div class="config-footer">
            <p class="config-info">Configuration auto-updates every 5 seconds</p>
          </div>
        </div>
      </div>

      <!-- Set-Up Panel -->
      <div id="setup-panel" class="setup-panel hidden">
        <!-- Loading Overlay -->
        <div id="setup-loading" class="setup-loading hidden">
          <div class="setup-spinner"></div>
          <div class="setup-loading-text">Loading setup...</div>
        </div>

        <!-- Status Bar -->
        <div class="setup-status-bar">
          <div class="status-left">
            <div id="setup-status-indicator" class="setup-status-dot fetching"></div>
            <span id="setup-status-text" class="setup-status-text">Loading setup options...</span>
          </div>
        </div>

        <div class="setup-content">
          <div class="setup-section ui-card">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">üß≠ Guided Setup</h3>
              <label class="field-label" for="expert-mode-toggle">
                <input type="checkbox" id="expert-mode-toggle" /> Expert mode
              </label>
            </div>
            <div class="setup-section-content">
              <div id="wizard-stepper" class="wizard-stepper" aria-label="Setup steps">
                <button type="button" class="wizard-step is-active" data-step="environment">
                  Environment
                  <span class="wizard-step-status" data-step-status="environment">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="preset">
                  Preset <span class="wizard-step-status" data-step-status="preset">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="review">
                  Review <span class="wizard-step-status" data-step-status="review">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="generate">
                  Generate <span class="wizard-step-status" data-step-status="generate">‚óã</span>
                </button>
              </div>
            </div>
          </div>

          <section class="setup-section ui-card wizard-step-panel" data-step-panel="environment">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">1) Environment</h3>
            </div>
            <div class="setup-section-content">
              <div class="setup-field ui-form-control">
                <label for="env-pi-version" class="field-label"
                  >Which hardware are you running?</label
                >
                <select id="env-pi-version" class="field-input">
                  <option value="">Select hardware</option>
                  <option value="pi3">Raspberry Pi 3</option>
                  <option value="pi4">Raspberry Pi 4</option>
                  <option value="pi5">Raspberry Pi 5</option>
                  <option value="other">Not a Raspberry Pi / Unsure</option>
                </select>
              </div>
              <div class="setup-field ui-form-control">
                <label for="env-intent" class="field-label">What do you care most about?</label>
                <select id="env-intent" class="field-input">
                  <option value="">Select primary intent</option>
                  <option value="webcam">Simple webcam streaming</option>
                  <option value="management">Management/API control and integrations</option>
                </select>
              </div>
              <div class="setup-field ui-form-control">
                <label for="env-mock-camera" class="field-label"
                  >Use mock camera for local development?</label
                >
                <select id="env-mock-camera" class="field-input">
                  <option value="false">No, use real camera</option>
                  <option value="true">Yes, use mock feed</option>
                </select>
              </div>
              <div class="setup-section ui-card setup-device-section">
                <div class="setup-section-header ui-panel-header">
                  <h3 class="setup-section-title">üì± Detected Devices</h3>
                </div>
                <div class="setup-section-content">
                  <div class="device-actions">
                    <button type="button" id="rescan-devices-btn" class="ui-btn-secondary">
                      Re-scan devices
                    </button>
                  </div>
                  <div id="device-status" class="device-status">Detecting devices...</div>
                </div>
              </div>
            </div>
          </section>

          <section class="setup-section ui-card wizard-step-panel hidden" data-step-panel="preset">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">2) Preset</h3>
            </div>
            <div class="setup-section-content">
              <div class="preset-selector ui-form-control">
                <label for="preset-select" class="preset-label">Recommended preset:</label>
                <select id="preset-select" class="preset-dropdown">
                  <option value="custom">Custom Configuration</option>
                  <option value="pi3_low_power">Pi3 Low Power (640x480, 12 FPS)</option>
                  <option value="pi5_high_quality">Pi5 High Quality (1280x720, 24 FPS)</option>
                </select>
              </div>
              <p id="preset-recommendation" class="field-hint">
                Answer environment questions to get a recommendation.
              </p>
            </div>
          </section>

          <section class="setup-section ui-card wizard-step-panel hidden" data-step-panel="review">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">3) Review</h3>
            </div>
            <div class="setup-section-content">
              <div id="review-summary" class="setup-instructions ui-list-block"></div>
              <div class="settings-group">
                <div class="setup-field ui-form-control">
                  <label for="setup-resolution" class="field-label">Resolution</label>
                  <input
                    type="text"
                    id="setup-resolution"
                    class="field-input"
                    placeholder="e.g., 640x480"
                    data-field="resolution"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-fps" class="field-label">Frame Rate (FPS)</label>
                  <input
                    type="number"
                    id="setup-fps"
                    class="field-input"
                    min="0"
                    max="120"
                    data-field="fps"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-jpeg-quality" class="field-label">JPEG Quality</label>
                  <input
                    type="number"
                    id="setup-jpeg-quality"
                    class="field-input"
                    min="1"
                    max="100"
                    data-field="jpeg_quality"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-max-connections" class="field-label"
                    >Max Stream Connections</label
                  >
                  <input
                    type="number"
                    id="setup-max-connections"
                    class="field-input"
                    min="1"
                    max="100"
                    data-field="max_connections"
                  />
                </div>
              </div>

              <details
                id="advanced-review-panel"
                class="setup-section ui-card setup-advanced-section"
              >
                <summary class="setup-section-header ui-panel-header">
                  <h3 class="setup-section-title">‚öôÔ∏è Advanced tuning</h3>
                </summary>
                <div class="setup-section-content">
                  <div class="settings-group">
                    <div class="setup-field ui-form-control">
                      <label for="setup-target-fps" class="field-label"
                        >Target FPS (Throttle)</label
                      >
                      <input
                        type="number"
                        id="setup-target-fps"
                        class="field-input"
                        min="0"
                        max="120"
                        data-field="target_fps"
                      />
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-pi3-profile" class="field-label"
                        >Enable Pi3 compatibility profile</label
                      >
                      <select id="setup-pi3-profile" class="field-input" data-field="pi3_profile">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                      </select>
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-cors-origins" class="field-label">CORS Origins</label>
                      <input
                        type="text"
                        id="setup-cors-origins"
                        class="field-input"
                        data-field="cors_origins"
                      />
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-mock-camera" class="field-label">Use Mock Camera</label>
                      <select id="setup-mock-camera" class="field-input" data-field="mock_camera">
                        <option value="false">No (use real camera)</option>
                        <option value="true">Yes (for testing)</option>
                      </select>
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-auth-token" class="field-label"
                        >Management Auth Token</label
                      >
                      <input
                        type="password"
                        id="setup-auth-token"
                        class="field-input"
                        placeholder="Leave empty for no authentication"
                        data-field="auth_token"
                      />
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </section>

          <section
            class="setup-section ui-card wizard-step-panel hidden"
            data-step-panel="generate"
          >
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">4) Generate</h3>
            </div>
            <div class="setup-section-content">
              <button id="generate-btn" class="generate-btn ui-btn ui-btn--primary">
                Generate Files
              </button>

              <div class="output-group">
                <div class="output-header">
                  <span class="output-filename">docker-compose.yaml</span>
                  <button
                    class="output-copy-btn"
                    data-target="docker-compose-output"
                    title="Copy to clipboard"
                  >
                    <span class="copy-icon">üìã</span>Copy
                  </button>
                </div>
                <textarea
                  id="docker-compose-output"
                  class="output-textarea"
                  readonly
                  placeholder="docker-compose.yaml will appear here after generation"
                ></textarea>
              </div>

              <div class="output-group">
                <div class="output-header">
                  <span class="output-filename">.env</span>
                  <button
                    class="output-copy-btn"
                    data-target="env-output"
                    title="Copy to clipboard"
                  >
                    <span class="copy-icon">üìã</span>Copy
                  </button>
                </div>
                <textarea
                  id="env-output"
                  class="output-textarea"
                  readonly
                  placeholder=".env will appear here after generation"
                ></textarea>
              </div>

              <div class="setup-instructions ui-list-block">
                <div class="instructions-header">üìù Next Steps:</div>
                <ol class="instructions-list">
                  <li>Copy each generated output.</li>
                  <li>Paste into your docker-compose.yaml and .env files.</li>
                  <li>Restart: <code>docker compose restart motion-in-ocean</code>.</li>
                </ol>
              </div>
            </div>
          </section>

          <div class="setup-section-content">
            <div class="setup-navigation">
              <button id="setup-prev-btn" type="button" class="ui-btn">Previous</button>
              <button id="setup-next-btn" type="button" class="ui-btn ui-btn--primary">Next</button>
            </div>
          </div>
          <!-- Error Alert -->
          <div id="setup-error-alert" class="setup-alert error hidden">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="setup-error-message" class="alert-message">Setup error</span>
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>

          <!-- Success Alert -->
          <div id="setup-success-alert" class="setup-alert success hidden">
            <span class="alert-icon">‚úÖ</span>
            <span id="setup-success-message" class="alert-message"
              >Configuration generated successfully!</span
            >
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
