<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="motion-in-ocean - Raspberry Pi Camera Live Stream" />
    <title>motion-in-ocean - Camera Stream</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" sizes="any" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}" />
    <link
      rel="apple-touch-icon-precomposed"
      href="{{ url_for('static', filename='apple-touch-icon-precomposed.png') }}"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabs-config.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}" />
  </head>
  <body
    class="webcam-page"
    data-mio-avatar="{{ url_for('static', filename='img/mio/mio_avatar.png') }}"
    data-mio-happy="{{ url_for('static', filename='img/mio/mio_happy.png') }}"
    data-mio-curious="{{ url_for('static', filename='img/mio/mio_curious.png') }}"
    data-mio-sleeping="{{ url_for('static', filename='img/mio/mio_sleeping.png') }}"
  >
    <div class="webcam-bg-pattern" aria-hidden="true"></div>

    <nav class="tab-navigation webcam-side-rail" aria-label="Webcam views">
      <div class="rail-primary-items">
        <button class="tab-btn active rail-btn" data-tab="main" id="main-tab-btn" title="Stream">
          <span class="rail-icon" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="3" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="3" width="7" height="7" rx="1" />
              <rect x="3" y="14" width="7" height="7" rx="1" />
              <rect x="14" y="14" width="7" height="7" rx="1" />
            </svg>
          </span>
          <span class="tab-label">Stream</span>
        </button>
        <button
          class="tab-btn rail-btn"
          data-tab="config"
          id="config-tab-btn"
          title="Configuration"
        >
          <span class="rail-icon" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
              />
              <circle cx="12" cy="13" r="4" />
            </svg>
          </span>
          <span class="tab-label">Config</span>
        </button>
        <button class="tab-btn rail-btn" data-tab="setup" id="setup-tab-btn" title="Set-Up">
          <span class="rail-icon" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
          </span>
          <span class="tab-label">Set-Up</span>
        </button>
        <button
          class="tab-btn rail-btn"
          data-tab="settings"
          id="settings-tab-btn"
          title="Runtime Settings"
        >
          <span class="rail-icon" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3" />
              <path
                d="M19.07 4.93l-1.41 1.41M4.93 4.93l1.41 1.41M19.07 19.07l-1.41-1.41M4.93 19.07l1.41-1.41M12 2v2M12 20v2M2 12h2M20 12h2"
              />
            </svg>
          </span>
          <span class="tab-label">Settings</span>
        </button>
      </div>
      <div class="rail-bottom-items">
        <button class="rail-util-btn" title="Changelog" aria-label="Changelog">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
          </svg>
        </button>
        <button class="rail-util-btn" title="Help" aria-label="Help">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
        </button>
      </div>
    </nav>

    <!-- Header -->
    <header class="header webcam-topbar">
      <div class="header-content">
        <div class="header-title">
          <h1 id="webcam-view-title">Stream</h1>
          <p id="webcam-view-subtitle" class="header-subtitle">Camera Live Stream</p>
        </div>

        <div class="header-actions">
          <div class="webcam-mio webcam-mio--hero" aria-live="polite">
            <img
              id="mio-hero-image"
              src="{{ url_for('static', filename='img/mio/mio_happy.png') }}"
              alt="Mio mascot for Stream view"
              width="56"
              height="56"
              loading="eager"
              decoding="async"
            />
          </div>
          <button
            id="theme-toggle-btn"
            class="ui-btn ui-btn--icon"
            type="button"
            aria-label="Toggle theme"
            title="Toggle theme"
          >
            <svg
              id="theme-icon-moon"
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
            <svg
              id="theme-icon-sun"
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="display: none"
            >
              <circle cx="12" cy="12" r="5" />
              <line x1="12" y1="1" x2="12" y2="3" />
              <line x1="12" y1="21" x2="12" y2="23" />
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
              <line x1="1" y1="12" x2="3" y2="12" />
              <line x1="21" y1="12" x2="23" y2="12" />
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
            </svg>
          </button>
          <button id="refresh-stream-header-btn" class="ui-btn ui-btn--primary" type="button">
            Refresh Stream ‚Ü∫
          </button>
        </div>
      </div>
      <div class="header-chips" role="status" aria-live="polite">
        <span class="header-chip header-chip--neutral">Stream Statistics</span>
        <span id="chip-connected" class="header-chip header-chip--connected">Stream Connected</span>
        <span id="chip-stale" class="header-chip header-chip--stale hidden">Stale stream</span>
        <span id="chip-inactive" class="header-chip header-chip--inactive hidden"
          >Camera inactive</span
        >
        <span id="chip-fps" class="header-chip header-chip--fps">Current FPS: --</span>
      </div>
    </header>

    <!-- Main Container -->
    <main class="container">
      <!-- Stream View Grid -->
      <section class="video-section" role="tabpanel">
        <div class="webcam-stream-grid">
          <!-- hidden metrics sources (still updated by JS) -->
          <span id="fps-value" class="sr-only" aria-hidden="true">--</span>
          <span id="connection-chip-value" class="sr-only" aria-hidden="true">--</span>
          <span id="last-frame-age-value" class="sr-only" aria-hidden="true">--</span>
          <span id="max-frame-age-value" class="sr-only" aria-hidden="true">--</span>
          <span id="last-updated" class="sr-only" aria-hidden="true"></span>
          <div
            id="status-indicator"
            class="status-indicator connecting"
            style="display: none"
            aria-hidden="true"
          ></div>
          <span id="status-text" class="sr-only" aria-hidden="true">Connecting...</span>

          <section class="stream-surface ui-card" aria-label="Camera live stream">
            <div class="stream-surface__header">
              <div>
                <h2>Camera Live Stream</h2>
                <p class="stream-surface__eyebrow">Primary Stream</p>
              </div>
              <div class="stream-surface__meta">
                <span id="resolution-value" class="stream-surface__resolution">
                  {{ width }} √ó {{ height }}
                </span>
                <div class="webcam-mio webcam-mio--context">
                  <img
                    id="mio-stream-image"
                    src="{{ url_for('static', filename='img/mio/mio_happy.png') }}"
                    alt="Mio mascot for Stream view"
                    width="64"
                    height="64"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              </div>
            </div>

            <div class="stream-surface__body">
              <div class="video-container ui-card">
                <div class="video-wrapper">
                  <div class="loading-overlay">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading camera stream...</div>
                  </div>

                  <!-- Stream status legend (shown when no active video) -->
                  <div class="stream-status-legend" id="stream-status-legend">
                    <div class="stream-legend-item stream-legend-item--loading">
                      <span class="legend-dot legend-dot--red"></span>
                      <span>Loading camera stream...</span>
                    </div>
                    <div class="stream-legend-item stream-legend-item--connected">
                      <span class="legend-dot legend-dot--blue"></span>
                      <span>Stream Connected</span>
                    </div>
                    <div class="stream-legend-item stream-legend-item--stale">
                      <span class="legend-dot legend-dot--amber"></span>
                      <span>Use Refresh if stream appears stale</span>
                    </div>
                  </div>

                  <img
                    id="video-stream"
                    class="video-stream"
                    src="{{ url_for('video_feed') }}"
                    alt="Camera Live Stream"
                    width="{{ width }}"
                    height="{{ height }}"
                  />
                </div>

                <div class="video-controls">
                  <button
                    id="refresh-btn"
                    class="control-btn ui-btn ui-btn--overlay"
                    title="Refresh Stream"
                  >
                    <span class="control-btn-icon">‚Üª</span>
                    <span class="control-btn-text">Refresh</span>
                  </button>
                  <button
                    id="fullscreen-btn"
                    class="control-btn ui-btn ui-btn--overlay"
                    title="Toggle Fullscreen"
                  >
                    <span class="control-btn-icon">‚õ∂</span>
                    <span class="control-btn-text">Fullscreen</span>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <aside id="stats-panel" class="stats-panel ui-card video-controls-panel">
            <div class="stats-header ui-panel-header">
              <h2>Video Controls</h2>
            </div>
            <div class="vc-items">
              <div class="vc-item" id="vc-camera-status">
                <div class="vc-item__icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                    />
                    <circle cx="12" cy="13" r="4" />
                  </svg>
                </div>
                <div class="vc-item__body">
                  <div class="vc-item__label" id="availability-risk-value">Camera inactive</div>
                  <div class="vc-item__detail">
                    <span id="performance-risk-value">-- FPS</span>
                    &middot;
                    <span id="frames-risk-detail">-- frames</span>
                  </div>
                </div>
              </div>

              <div class="vc-item" id="vc-stream-actions">
                <div class="vc-item__icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polygon points="5 3 19 12 5 21 5 3" />
                  </svg>
                </div>
                <div class="vc-item__body">
                  <div class="vc-item__actions">
                    <button
                      id="vc-refresh-btn"
                      class="vc-action-btn"
                      title="Refresh stream"
                      onclick="document.getElementById('refresh-btn').click()"
                    >
                      Refresh
                    </button>
                    <span class="vc-action-sep">&middot;</span>
                    <button
                      id="vc-fullscreen-btn"
                      class="vc-action-btn"
                      title="Toggle fullscreen"
                      onclick="document.getElementById('fullscreen-btn').click()"
                    >
                      Fullscreen
                    </button>
                  </div>
                </div>
              </div>

              <div class="vc-item" id="vc-connection">
                <div class="vc-item__icon vc-item__icon--spin" id="vc-connection-spinner">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="23 4 23 10 17 10" />
                    <polyline points="1 20 1 14 7 14" />
                    <path
                      d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                    />
                  </svg>
                </div>
                <div class="vc-item__body">
                  <div class="vc-item__label" id="stream-risk-value">Connecting...</div>
                  <div class="vc-item__detail">
                    Last frame: <span id="last-frame-risk-value">--</span> &nbsp;/&nbsp;Max:
                    <span id="max-frame-risk-value">--</span>
                  </div>
                </div>
              </div>

              <div class="vc-item" id="vc-availability">
                <div class="vc-item__icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                  </svg>
                </div>
                <div class="vc-item__body">
                  <div class="vc-item__label">Connections</div>
                  <div class="vc-item__detail" id="availability-detail">-- connections</div>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- Configuration Panel -->

      <!-- Configuration Panel -->
      <div id="config-panel" class="config-panel hidden" role="tabpanel">
        <!-- Loading Overlay -->
        <div id="config-loading" class="config-loading hidden">
          <div class="config-spinner"></div>
          <div class="config-loading-text">Loading configuration...</div>
        </div>

        <div class="config-content">
          <div class="webcam-panel-mio webcam-panel-mio--config">
            <div class="webcam-mio webcam-mio--context">
              <img
                id="mio-config-image"
                src="{{ url_for('static', filename='img/mio/mio_curious.png') }}"
                alt="Mio mascot for Configuration view"
                width="64"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </div>
          </div>
          <!-- Camera Settings Group (Editable) -->
          <div class="config-group editable-section ui-card">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">Camera Settings</h3>
              <button class="config-group-toggle" data-group="camera" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="camera">
              <div class="config-item ui-form-control">
                <span class="config-label">Resolution</span>
                <span id="config-resolution" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Frame Rate (FPS)</span>
                <span id="config-fps" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Target FPS (Throttle)</span>
                <span id="config-target-fps" class="config-value" data-config-value="true">--</span>
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">JPEG Quality</span>
                <span id="config-jpeg-quality" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
            </div>
          </div>

          <!-- Stream Control Group (Read-only) -->
          <div class="config-group readonly-section ui-card">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">Stream Control</h3>
              <button class="config-group-toggle" data-group="stream" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="stream">
              <div class="config-item ui-form-control">
                <span class="config-label">Max Connections</span>
                <span id="config-max-connections" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Current Connections</span>
                <span
                  id="config-current-connections"
                  class="config-value highlight"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Max Frame Age (Timeout)</span>
                <span id="config-max-frame-age" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">CORS Origins</span>
                <span id="config-cors" class="config-value" data-config-value="true">--</span>
              </div>
            </div>
          </div>

          <!-- Health Check Group (Read-only) -->
          <div class="config-group readonly-section ui-card">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">Health Check</h3>
              <button class="config-group-toggle" data-group="health" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="health">
              <div class="config-item ui-form-control">
                <span class="config-label">Overall Status</span>
                <span
                  id="config-health-overall"
                  class="config-value highlight"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Camera Pipeline</span>
                <span
                  id="config-health-camera-pipeline"
                  class="config-value"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Stream Freshness</span>
                <span
                  id="config-health-stream-freshness"
                  class="config-value"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Connection Capacity</span>
                <span
                  id="config-health-connection-capacity"
                  class="config-value"
                  data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Mock Mode</span>
                <span id="config-health-mock-mode" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
            </div>
          </div>

          <!-- Runtime Info Group (Read-only) -->
          <div class="config-group readonly-section ui-card">
            <div class="config-group-header ui-panel-header">
              <h3 class="config-group-title">Health & Runtime Surface</h3>
              <button class="config-group-toggle" data-group="runtime" title="Toggle">‚ñº</button>
            </div>
            <div class="config-group-content" data-group="runtime">
              <div class="config-item ui-form-control">
                <span class="config-label">Camera Active</span>
                <span id="config-camera-active" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Mock Camera</span>
                <span id="config-mock-camera" class="config-value" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Uptime</span>
                <span id="config-uptime" class="config-value highlight" data-config-value="true"
                  >--</span
                >
              </div>
              <div class="config-item ui-form-control">
                <span class="config-label">Last Updated</span>
                <span id="config-timestamp" class="config-value" data-config-value="true">--</span>
              </div>
            </div>
          </div>

          <!-- Error Alert -->
          <div id="config-error-alert" class="config-alert error hidden">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="config-error-message" class="alert-message"
              >Failed to load configuration</span
            >
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>

          <!-- Footer -->
          <div class="config-footer">
            <div class="config-footer-actions">
              <p class="config-info">Configuration auto-updates every 5 seconds</p>
              <button id="config-refresh-btn" class="ui-btn ui-btn--secondary" type="button">
                Refresh Config ‚Üª
              </button>
            </div>
            <div class="config-health-legend" aria-label="Health status legend">
              <span class="config-health-legend-label">Health:</span>
              <span class="config-value health-indicator health-ok">OK = normal</span>
              <span class="config-value health-indicator health-warn">Warn = attention</span>
              <span class="config-value health-indicator health-fail">Fail = action needed</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div id="settings-panel" class="settings-panel hidden" role="tabpanel">
        <!-- Loading Overlay -->
        <div id="settings-loading" class="settings-loading hidden">
          <div class="settings-spinner"></div>
          <div class="settings-loading-text">Loading settings...</div>
        </div>

        <div class="settings-content">
          <div class="webcam-panel-mio webcam-panel-mio--settings">
            <div class="webcam-mio webcam-mio--context">
              <img
                id="mio-settings-image"
                src="{{ url_for('static', filename='img/mio/mio_sleeping.png') }}"
                alt="Mio mascot for Runtime Settings view"
                width="64"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </div>
          </div>
          <!-- Settings Header -->
          <div class="settings-header ui-card">
            <h2>Configuration</h2>
            <p class="settings-description">
              Edit these settings to customize your camera streaming experience. Changes are applied
              immediately or on next restart depending on the setting.
            </p>
            <div class="settings-actions">
              <button id="settings-save-btn" class="ui-btn ui-btn--primary" disabled>
                Save Changes
              </button>
              <button id="settings-reset-btn" class="ui-btn ui-btn--secondary">
                Reset to Defaults
              </button>
            </div>
          </div>

          <!-- Camera Settings Section -->
          <section id="settings-camera" class="settings-section ui-card">
            <div class="settings-section-header ui-panel-header">
              <h3 class="settings-section-title">Camera Configuration</h3>
              <button class="settings-section-toggle" data-section="camera" title="Toggle">
                ‚ñº
              </button>
            </div>
            <div class="settings-section-content" data-section="camera">
              <!-- Resolution -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-resolution" class="setting-label">Resolution</label>
                  <span class="setting-description-inline">Video resolution (WIDTHxHEIGHT)</span>
                </div>
                <select
                  id="setting-resolution"
                  class="setting-input setting-select"
                  data-category="camera"
                  data-property="resolution"
                >
                  <option value="">Select resolution...</option>
                  <option value="640x480">640x480 (VGA)</option>
                  <option value="1280x720">1280x720 (HD)</option>
                  <option value="1920x1080">1920x1080 (Full HD)</option>
                  <option value="2592x1944">2592x1944 (5MP)</option>
                </select>
                <span class="setting-hint">Changing resolution requires camera restart</span>
              </div>

              <!-- FPS -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-fps" class="setting-label">Frame Rate (FPS)</label>
                  <span class="setting-description-inline"
                    >Frames per second (0 = camera default)</span
                  >
                </div>
                <input
                  type="range"
                  id="setting-fps"
                  class="setting-input setting-slider"
                  data-category="camera"
                  data-property="fps"
                  min="0"
                  max="120"
                  value="30"
                />
                <div class="setting-value-display">
                  <span class="setting-current-value">30</span> fps
                </div>
                <span class="setting-hint">Changing FPS requires camera restart</span>
              </div>

              <!-- JPEG Quality -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-jpeg-quality" class="setting-label">JPEG Quality</label>
                  <span class="setting-description-inline">Compression level (1-100)</span>
                </div>
                <input
                  type="range"
                  id="setting-jpeg-quality"
                  class="setting-input setting-slider"
                  data-category="camera"
                  data-property="jpeg_quality"
                  min="1"
                  max="100"
                  value="85"
                />
                <div class="setting-value-display">
                  <span class="setting-current-value">85</span>
                </div>
                <span class="setting-hint"
                  >Lower quality = smaller files, higher quality = better images</span
                >
              </div>

              <!-- Max Stream Connections -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-max-connections" class="setting-label"
                    >Max Stream Connections</label
                  >
                  <span class="setting-description-inline">Maximum concurrent clients</span>
                </div>
                <input
                  type="number"
                  id="setting-max-connections"
                  class="setting-input setting-number"
                  data-category="camera"
                  data-property="max_stream_connections"
                  min="1"
                  max="100"
                  value="2"
                />
                <span class="setting-hint">Limit concurrent streams to prevent overload</span>
              </div>

              <!-- Frame Cache Age -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-max-frame-age" class="setting-label"
                    >Frame Cache Age (seconds)</label
                  >
                  <span class="setting-description-inline">How long to cache frames</span>
                </div>
                <input
                  type="number"
                  id="setting-max-frame-age"
                  class="setting-input setting-number"
                  data-category="camera"
                  data-property="max_frame_age_seconds"
                  min="0.5"
                  max="60"
                  step="0.5"
                  value="10"
                />
                <span class="setting-hint"
                  >Higher values = more frame reuse, potentially stale frames</span
                >
              </div>
            </div>
          </section>

          <!-- Logging Settings Section -->
          <section id="settings-logging" class="settings-section ui-card">
            <div class="settings-section-header ui-panel-header">
              <h3 class="settings-section-title">Logging Configuration</h3>
              <button class="settings-section-toggle" data-section="logging" title="Toggle">
                ‚ñº
              </button>
            </div>
            <div class="settings-section-content" data-section="logging">
              <!-- Log Level -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-log-level" class="setting-label">Log Level</label>
                  <span class="setting-description-inline">Logging verbosity</span>
                </div>
                <select
                  id="setting-log-level"
                  class="setting-input setting-select"
                  data-category="logging"
                  data-property="log_level"
                >
                  <option value="DEBUG">DEBUG (Most verbose)</option>
                  <option value="INFO" selected>INFO (Standard)</option>
                  <option value="WARNING">WARNING</option>
                  <option value="ERROR">ERROR</option>
                  <option value="CRITICAL">CRITICAL (Least verbose)</option>
                </select>
              </div>

              <!-- Log Format -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-log-format" class="setting-label">Log Format</label>
                  <span class="setting-description-inline">Output format</span>
                </div>
                <select
                  id="setting-log-format"
                  class="setting-input setting-select"
                  data-category="logging"
                  data-property="log_format"
                >
                  <option value="text" selected>Human-Readable Text</option>
                  <option value="json">Structured JSON</option>
                </select>
                <span class="setting-hint">Changing log format requires server restart</span>
              </div>

              <!-- Include Identifiers -->
              <div class="settings-control ui-form-control">
                <input
                  type="checkbox"
                  id="setting-log-identifiers"
                  class="setting-input setting-checkbox"
                  data-category="logging"
                  data-property="log_include_identifiers"
                />
                <label for="setting-log-identifiers" class="setting-label"
                  >Include Process/Thread IDs</label
                >
                <span class="setting-hint">Useful for debugging concurrency issues</span>
              </div>
            </div>
          </section>

          <!-- Discovery Settings Section -->
          <section id="settings-discovery" class="settings-section ui-card">
            <div class="settings-section-header ui-panel-header">
              <h3 class="settings-section-title">Node Discovery</h3>
              <button class="settings-section-toggle" data-section="discovery" title="Toggle">
                ‚ñº
              </button>
            </div>
            <div class="settings-section-content" data-section="discovery">
              <!-- Discovery Enabled -->
              <div class="settings-control ui-form-control">
                <input
                  type="checkbox"
                  id="setting-discovery-enabled"
                  class="setting-input setting-checkbox"
                  data-category="discovery"
                  data-property="discovery_enabled"
                />
                <label for="setting-discovery-enabled" class="setting-label"
                  >Enable Discovery</label
                >
                <span class="setting-hint"
                  >Announce this webcam to a management node automatically</span
                >
              </div>

              <!-- Management URL -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-discovery-url" class="setting-label"
                    >Management Node URL</label
                  >
                  <span class="setting-description-inline">e.g., http://192.168.1.10:8001</span>
                </div>
                <input
                  type="text"
                  id="setting-discovery-url"
                  class="setting-input setting-text"
                  data-category="discovery"
                  data-property="discovery_management_url"
                  placeholder="http://127.0.0.1:8001"
                />
              </div>

              <!-- Discovery Token -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-discovery-token" class="setting-label"
                    >Discovery Shared Token</label
                  >
                  <span class="setting-description-inline"
                    >Must match management node's shared secret</span
                  >
                </div>
                <input
                  type="password"
                  id="setting-discovery-token"
                  class="setting-input setting-text"
                  data-category="discovery"
                  data-property="discovery_token"
                  placeholder="Leave empty to disable"
                />
              </div>

              <!-- Discovery Interval -->
              <div class="settings-control ui-form-control">
                <div class="setting-label-group">
                  <label for="setting-discovery-interval" class="setting-label"
                    >Discovery Interval (seconds)</label
                  >
                  <span class="setting-description-inline">Re-announce frequency</span>
                </div>
                <input
                  type="number"
                  id="setting-discovery-interval"
                  class="setting-input setting-number"
                  data-category="discovery"
                  data-property="discovery_interval_seconds"
                  min="5"
                  max="3600"
                  step="5"
                  value="30"
                />
              </div>
            </div>
          </section>

          <!-- Feature Flags Section -->
          <section id="settings-features" class="settings-section ui-card">
            <div class="settings-section-header ui-panel-header">
              <h3 class="settings-section-title">Feature Flags</h3>
              <button class="settings-section-toggle" data-section="features" title="Toggle">
                ‚ñº
              </button>
            </div>
            <div
              class="settings-section-content"
              data-section="features"
              id="feature-flags-container"
            >
              <!-- Feature flags will be dynamically loaded here -->
              <div class="setting-placeholder">Loading feature flags...</div>
            </div>
          </section>

          <!-- Changes Summary -->
          <div id="settings-changes-summary" class="settings-changes-summary hidden">
            <h3>Summary of Changes</h3>
            <div id="settings-changes-list" class="settings-changes-list">
              <!-- Changes will be listed here -->
            </div>
            <div id="settings-restart-warning" class="settings-restart-warning hidden">
              <span class="warning-icon">‚ö†Ô∏è</span>
              <span class="warning-text"
                >Some changes require a server restart to take effect.</span
              >
            </div>
          </div>

          <!-- Error Alert -->
          <div id="settings-error-alert" class="settings-alert error hidden">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="settings-error-message" class="alert-message">Settings error</span>
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>

          <!-- Success Alert -->
          <div id="settings-success-alert" class="settings-alert success hidden">
            <span class="alert-icon">‚úÖ</span>
            <span id="settings-success-message" class="alert-message"
              >Settings saved successfully!</span
            >
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>
        </div>
      </div>

      <!-- Set-Up Panel -->
      <div id="setup-panel" class="setup-panel hidden" role="tabpanel">
        <!-- Loading Overlay -->
        <div id="setup-loading" class="setup-loading hidden">
          <div class="setup-spinner"></div>
          <div class="setup-loading-text">Loading setup...</div>
        </div>

        <!-- Status Bar -->
        <div class="setup-status-bar">
          <div class="status-left">
            <div id="setup-status-indicator" class="setup-status-dot fetching"></div>
            <span id="setup-status-text" class="setup-status-text">Loading setup options...</span>
          </div>
        </div>

        <div class="setup-content">
          <div class="webcam-panel-mio webcam-panel-mio--setup">
            <div class="webcam-mio webcam-mio--context">
              <img
                id="mio-setup-image"
                src="{{ url_for('static', filename='img/mio/mio_avatar.png') }}"
                alt="Mio mascot for Set-Up view"
                width="64"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </div>
          </div>
          <div class="setup-section ui-card">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">Guided Setup</h3>
              <label class="field-label" for="expert-mode-toggle">
                <input type="checkbox" id="expert-mode-toggle" /> Expert mode
              </label>
            </div>
            <div class="setup-section-content">
              <div id="wizard-stepper" class="wizard-stepper" aria-label="Setup steps">
                <button type="button" class="wizard-step is-active" data-step="environment">
                  Environment
                  <span class="wizard-step-status" data-step-status="environment">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="preset">
                  Preset <span class="wizard-step-status" data-step-status="preset">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="review">
                  Review <span class="wizard-step-status" data-step-status="review">‚óã</span>
                </button>
                <button type="button" class="wizard-step" data-step="generate">
                  Generate <span class="wizard-step-status" data-step-status="generate">‚óã</span>
                </button>
              </div>
            </div>
          </div>

          <section class="setup-section ui-card wizard-step-panel" data-step-panel="environment">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">1) Environment</h3>
            </div>
            <div class="setup-section-content">
              <div class="setup-field ui-form-control">
                <label for="env-pi-version" class="field-label"
                  >Which hardware are you running?</label
                >
                <select id="env-pi-version" class="field-input">
                  <option value="">Select hardware</option>
                  <option value="pi3">Raspberry Pi 3</option>
                  <option value="pi4">Raspberry Pi 4</option>
                  <option value="pi5">Raspberry Pi 5</option>
                  <option value="other">Not a Raspberry Pi / Unsure</option>
                </select>
              </div>
              <div class="setup-field ui-form-control">
                <label for="env-intent" class="field-label">What do you care most about?</label>
                <select id="env-intent" class="field-input">
                  <option value="">Select primary intent</option>
                  <option value="webcam">Simple webcam streaming</option>
                  <option value="management">Management/API control and integrations</option>
                </select>
              </div>
              <div class="setup-field ui-form-control">
                <label for="env-mock-camera" class="field-label"
                  >Use mock camera for local development?</label
                >
                <select id="env-mock-camera" class="field-input">
                  <option value="false">No, use real camera</option>
                  <option value="true">Yes, use mock feed</option>
                </select>
              </div>
              <div class="setup-section ui-card setup-device-section">
                <div class="setup-section-header ui-panel-header">
                  <h3 class="setup-section-title">üì± Detected Devices</h3>
                </div>
                <div class="setup-section-content">
                  <div class="device-actions">
                    <button type="button" id="rescan-devices-btn" class="ui-btn-secondary">
                      Re-scan devices
                    </button>
                  </div>
                  <div id="device-status" class="device-status">Detecting devices...</div>
                </div>
              </div>
            </div>
          </section>

          <section class="setup-section ui-card wizard-step-panel hidden" data-step-panel="preset">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">2) Preset</h3>
            </div>
            <div class="setup-section-content">
              <div class="preset-selector ui-form-control">
                <label for="preset-select" class="preset-label">Recommended preset:</label>
                <select id="preset-select" class="preset-dropdown">
                  <option value="custom">Custom Configuration</option>
                  <option value="pi3_low_power">Pi3 Low Power (640x480, 12 FPS)</option>
                  <option value="pi5_high_quality">Pi5 High Quality (1280x720, 24 FPS)</option>
                </select>
              </div>
              <p id="preset-recommendation" class="field-hint">
                Answer environment questions to get a recommendation.
              </p>
            </div>
          </section>

          <section class="setup-section ui-card wizard-step-panel hidden" data-step-panel="review">
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">3) Review</h3>
            </div>
            <div class="setup-section-content">
              <div id="review-summary" class="setup-instructions ui-list-block"></div>
              <div class="settings-group">
                <div class="setup-field ui-form-control">
                  <label for="setup-resolution" class="field-label">Resolution</label>
                  <input
                    type="text"
                    id="setup-resolution"
                    class="field-input"
                    placeholder="e.g., 640x480"
                    data-field="resolution"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-fps" class="field-label">Frame Rate (FPS)</label>
                  <input
                    type="number"
                    id="setup-fps"
                    class="field-input"
                    min="1"
                    max="120"
                    data-field="fps"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-jpeg-quality" class="field-label">JPEG Quality</label>
                  <input
                    type="number"
                    id="setup-jpeg-quality"
                    class="field-input"
                    min="1"
                    max="100"
                    data-field="jpeg_quality"
                  />
                </div>
                <div class="setup-field ui-form-control">
                  <label for="setup-max-connections" class="field-label"
                    >Max Stream Connections</label
                  >
                  <input
                    type="number"
                    id="setup-max-connections"
                    class="field-input"
                    min="1"
                    max="100"
                    data-field="max_connections"
                  />
                </div>
              </div>

              <details
                id="advanced-review-panel"
                class="setup-section ui-card setup-advanced-section"
              >
                <summary class="setup-section-header ui-panel-header">
                  <h3 class="setup-section-title">‚öôÔ∏è Advanced tuning</h3>
                </summary>
                <div class="setup-section-content">
                  <div class="settings-group">
                    <div class="setup-field ui-form-control">
                      <label for="setup-target-fps" class="field-label"
                        >Target FPS (Throttle)</label
                      >
                      <input
                        type="number"
                        id="setup-target-fps"
                        class="field-input"
                        min="1"
                        max="120"
                        data-field="target_fps"
                      />
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-pi3-profile" class="field-label"
                        >Enable Pi3 compatibility profile</label
                      >
                      <select id="setup-pi3-profile" class="field-input" data-field="pi3_profile">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                      </select>
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-cors-origins" class="field-label">CORS Origins</label>
                      <input
                        type="text"
                        id="setup-cors-origins"
                        class="field-input"
                        data-field="cors_origins"
                      />
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-mock-camera" class="field-label">Use Mock Camera</label>
                      <select id="setup-mock-camera" class="field-input" data-field="mock_camera">
                        <option value="false">No (use real camera)</option>
                        <option value="true">Yes (for testing)</option>
                      </select>
                    </div>
                    <div class="setup-field ui-form-control">
                      <label for="setup-auth-token" class="field-label"
                        >Management Auth Token</label
                      >
                      <input
                        type="password"
                        id="setup-auth-token"
                        class="field-input"
                        placeholder="Leave empty for no authentication"
                        data-field="auth_token"
                      />
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </section>

          <section
            class="setup-section ui-card wizard-step-panel hidden"
            data-step-panel="generate"
          >
            <div class="setup-section-header ui-panel-header">
              <h3 class="setup-section-title">4) Generate</h3>
            </div>
            <div class="setup-section-content">
              <button id="generate-btn" class="generate-btn ui-btn ui-btn--primary">
                Generate Files
              </button>

              <div class="output-group">
                <div class="output-header">
                  <span class="output-filename">docker-compose.yaml</span>
                  <button
                    class="output-copy-btn"
                    data-target="docker-compose-output"
                    title="Copy to clipboard"
                  >
                    <span class="copy-icon">üìã</span>Copy
                  </button>
                </div>
                <textarea
                  id="docker-compose-output"
                  class="output-textarea"
                  readonly
                  placeholder="docker-compose.yaml will appear here after generation"
                ></textarea>
              </div>

              <div class="output-group">
                <div class="output-header">
                  <span class="output-filename">.env</span>
                  <button
                    class="output-copy-btn"
                    data-target="env-output"
                    title="Copy to clipboard"
                  >
                    <span class="copy-icon">üìã</span>Copy
                  </button>
                </div>
                <textarea
                  id="env-output"
                  class="output-textarea"
                  readonly
                  placeholder=".env will appear here after generation"
                ></textarea>
              </div>

              <div class="setup-instructions ui-list-block">
                <div class="instructions-header">üìù Next Steps:</div>
                <ol class="instructions-list">
                  <li>Copy each generated output.</li>
                  <li>Paste into your docker-compose.yaml and .env files.</li>
                  <li>Restart: <code>docker compose restart motion-in-ocean</code>.</li>
                </ol>
              </div>
            </div>
          </section>

          <div class="setup-section-content">
            <div class="setup-navigation">
              <button id="setup-prev-btn" type="button" class="ui-btn">Previous</button>
              <button id="setup-next-btn" type="button" class="ui-btn ui-btn--primary">Next</button>
            </div>
          </div>
          <!-- Error Alert -->
          <div id="setup-error-alert" class="setup-alert error hidden">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="setup-error-message" class="alert-message">Setup error</span>
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>

          <!-- Success Alert -->
          <div id="setup-success-alert" class="setup-alert success hidden">
            <span class="alert-icon">‚úÖ</span>
            <span id="setup-success-message" class="alert-message"
              >Configuration generated successfully!</span
            >
            <button class="alert-dismiss" onclick="this.parentElement.classList.add('hidden')">
              √ó
            </button>
          </div>
        </div>
      </div>
    </main>

    <nav class="tab-navigation webcam-bottom-rail" aria-label="Webcam views mobile">
      <button
        class="tab-btn mobile-rail-btn active"
        data-tab="main"
        id="mobile-main-tab-btn"
        title="Stream"
      >
        <span class="tab-label">Stream</span>
      </button>
      <button
        class="tab-btn mobile-rail-btn"
        data-tab="config"
        id="mobile-config-tab-btn"
        title="Configuration"
      >
        <span class="tab-label">Config</span>
      </button>
      <button
        class="tab-btn mobile-rail-btn"
        data-tab="setup"
        id="mobile-setup-tab-btn"
        title="Set-Up"
      >
        <span class="tab-label">Set-Up</span>
      </button>
      <button
        class="tab-btn mobile-rail-btn"
        data-tab="settings"
        id="mobile-settings-tab-btn"
        title="Runtime Settings"
      >
        <span class="tab-label">Settings</span>
      </button>
    </nav>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
  </body>
</html>
